#!/bin/bash
#
# sickbeard			Startup script for Sickbeard PVR
#
# chkconfig: - 16 84
# description: The ultimate PVR application that searches for and manages your TV shows \
#              Automatically finds new and old episodes for you and it works with your current download client!
# processname: sickbeard
# pidfile: /var/run/sickbeard/sickbeard.pid
#
### BEGIN INIT INFO
# Provides: sickbeard
# Required-Start:    $all
# Required-Stop:     $all
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
# Short-Description: start and stop Sickbeard
# Description: Sickbeard PVR Server 
### END INIT INFO

# Source function library.
. /etc/rc.d/init.d/functions

# Get network config
. /etc/sysconfig/network

# Defaults
PATH=/usr/bin:/usr/local/bin:/usr/local/sbin:/sbin:/bin:/usr/sbin
PYTHON_LOCATION="/usr/local/bin/python2.7"

# Daemon info
DAEMON_USER="sabnzbd"
DAEMON_LOCATION="/usr/local/sickbeard/Sickbeard.py"
DAEMON_ARGS="-q"
DAEMON_URL="http://<%= ipaddress %>/sickbeard"
RETVAL=0

start() {
	echo -n $"Starting Sickbeard: "
    /usr/bin/sudo -u $DAEMON_USER -H $PYTHON_LOCATION $DAEMON_LOCATION $DAEMON_ARGS
    RETVAL=$?
    PID=$!
    echo [ $RETVAL = 0 ]
    return $RETVAL
}

stop() {
	echo -n $"Stopping Sickbeard: "
	/usr/bin/wget -q --delete-after "$DAEMON_URL/home/shutdown/?pid=$PID"
	RETVAL=$?
	echo [ $RETVAL = 0 ]
    return $RETVAL
}

restart() {
	echo -n $"Restarting Sickbeard: "
	/usr/bin/wget -q --delete-after "$DAEMON_URL/home/restart/?pid=$PID"
	RETVAL=$?
	echo [ $RETVAL = 0 ]
    return $RETVAL
}

case "$1" in
   start)
        start
        RETVAL=$?
        ;;
   stop)
        stop
        RETVAL=$?
        ;;
   restart)
        stop
        start
        RETVAL=$?
        ;;
   force-reload)
        stop
        start
        RETVAL=$?
        ;;
   *)
   echo "Usage:$0{start|stop|restart|force-reload}"
   RETVAL=1
esac
exit $RETVAL